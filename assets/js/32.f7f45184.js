(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{387:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"可视化的javascript-三-作用域-链"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可视化的javascript-三-作用域-链"}},[t._v("#")]),t._v(" 可视化的JavaScript —— （三）作用域（链）")]),t._v(" "),a("p",[t._v("【三】"),a("a",{attrs:{href:"https://dev.to/lydiahallie/javascript-visualized-scope-chain-13pd",target:"_blank",rel:"noopener noreferrer"}},[t._v("JavaScript Visualized: Scope (Chain)"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("是时候来介绍下作用域（链）了。假设您已经了解执行上下文的基础，不管怎样，我会很快就执行上下文发表一篇文章😃")]),t._v(" "),a("p",[t._v("首先让我们看下面的代码：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Lydia"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" age "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" city "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"San Francisco"')]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPersonInfo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Sarah"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" age "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(" is ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("age"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(" and lives in ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("city"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPersonInfo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("p",[t._v("我们调用"),a("code",[t._v("getPersonInfo")]),t._v("函数，该函数返回一个包含值"),a("code",[t._v("name")]),t._v("，"),a("code",[t._v("age")]),t._v("和"),a("code",[t._v("city")]),t._v("的字符串"),a("code",[t._v("：")]),t._v("Sarah is 22 and lives in San Francisco"),a("code",[t._v("。但是，该")]),t._v("getPersonInfo"),a("code",[t._v("函数不包含名为city🤨的变量。它怎么知道的")]),t._v("city`值？")]),t._v(" "),a("p",[t._v("首先，为不同的上下文设置存储空间。我们有默认的全局上下文（"),a("code",[t._v("window")]),t._v("在浏览器中，"),a("code",[t._v("global")]),t._v("在"),a("code",[t._v("Node")]),t._v("），以及一个为"),a("code",[t._v("getPersonInfo")]),t._v("调用准备的局部上下文，每个上下文都有一个作用域链。")]),t._v(" "),a("p",[t._v("对于该"),a("code",[t._v("getPersonInfo")]),t._v("函数，作用域链看起来像这样:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/23453305/118239471-683ba700-b4cc-11eb-86ea-9518fb2b6d50.png",alt:"89b9buizhevs0jf6djyn"}})]),t._v(" "),a("p",[t._v("基本上说，作用域链是对对象的“引用链”，这些对象包含对在该执行上下文中可引用的值（和其他作用域）的引用。（⛓：“嘿，这些都是您可以在此上下文中引用的所有值”。）作用域链是在创建执行上下文时创建的，这意味着它是在运行时创建的！")]),t._v(" "),a("p",[t._v("但是，在本文中，我一般不会讨论活动对象或执行上下文，我们只关注"),a("strong",[t._v("作用域")]),t._v("！在以下示例中，执行上下文中的 键/值对 表示作用域链对变量的引用。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/23453305/118239504-72f63c00-b4cc-11eb-93b2-d05e67fda14c.png",alt:"iala2et7bg9bgdj4c2lg"}})]),t._v(" "),a("p",[t._v("全局执行上下文的作用域链引用了3个变量："),a("code",[t._v("name")]),t._v("带有值 "),a("code",[t._v("Lydia")]),t._v("，"),a("code",[t._v("age")]),t._v("带有值"),a("code",[t._v("21")]),t._v("，"),a("code",[t._v("city")]),t._v("带有值 "),a("code",[t._v("San Francisco")]),t._v("。在局部上下文中，我们引用了2个变量："),a("code",[t._v("name")]),t._v("使用值 "),a("code",[t._v("Sarah")]),t._v(" 和 "),a("code",[t._v("age")]),t._v(" 使用值 22。")]),t._v(" "),a("p",[t._v("当我们尝试访问"),a("code",[t._v("getPersonInfo")]),t._v("函数中的变量时，引擎首先检查局部作用域链。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/23453305/118241253-85717500-b4ce-11eb-9048-90ddf27c4288.gif",alt:"xn17f0t54acz8tiq7122"}})]),t._v(" "),a("p",[t._v("局部作用域链具有对"),a("code",[t._v("name")]),t._v("和"),a("code",[t._v("age")]),t._v("的引用！"),a("code",[t._v("name")]),t._v("值为"),a("code",[t._v("Sarah")]),t._v("，"),a("code",[t._v("age")]),t._v("值为"),a("code",[t._v("22")]),t._v("。但是现在，当它尝试访问"),a("code",[t._v("city")]),t._v("时会发生什么？")]),t._v(" "),a("p",[t._v("为了找到city的值，引擎会“沿作用域链”查找。这意味着引擎不会轻易放弃：它会努力查看是否可以在局部作用域引用的外部作用域（在当前情况下为全局对象）中找到变量"),a("code",[t._v("city")]),t._v("的值。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/23453305/118242073-7ccd6e80-b4cf-11eb-9e5f-2c4c0e7ab5fd.gif",alt:"z9iclg23rmbpts7meoq6"}})]),t._v(" "),a("p",[t._v("在全局上下文中，"),a("code",[t._v("city")]),t._v("变量的值声明了"),a("code",[t._v("San Francisco")]),t._v("，因此引用了该变量"),a("code",[t._v("city")]),t._v("。现在我们有了变量的值，该函数"),a("code",[t._v("getPersonInfo")]),t._v("可以返回字符串"),a("code",[t._v("Sarah is 22 and lives in San Francisco")]),t._v("🎉。")]),t._v(" "),a("p",[a("strong",[t._v("您可以使用外部作用域，但不能访问更内部作用域")]),t._v("。可以形象地看，类似一种瀑布：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/23453305/118242626-201e8380-b4d0-11eb-8c37-61b0ad4296df.png",alt:"image"}})]),t._v(" "),a("p",[t._v("可以更深：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/23453305/118242778-43493300-b4d0-11eb-9d72-a4f4a0da3282.png",alt:"image"}})]),t._v(" "),a("p",[t._v("让我们以这段代码为例：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/23453305/118242863-5825c680-b4d0-11eb-9109-7ade54150298.png",alt:"image"}})]),t._v(" "),a("p",[t._v("几乎是一样的，但有一个很大的不同：我们仅在"),a("code",[t._v("getPersonInfo")]),t._v("函数内声明"),a("code",[t._v("city")]),t._v("，现在不是在全局作用域内。我们没有调用该getPersonInfo函数，因此也没有创建局部上下文。然而，我们试图访问全局作用域内的"),a("code",[t._v("name")]),t._v("，"),a("code",[t._v("age")]),t._v("和"),a("code",[t._v("city")]),t._v("。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/23453305/118244813-8c9a8200-b4d2-11eb-8096-016e66baa175.gif",alt:"f3wvlo4c3gqf3mve1g0n"}})]),t._v(" "),a("p",[t._v("它抛出一个"),a("code",[t._v("ReferenceError")]),t._v("！它在全局作用域中找不到一个叫做city的变量的引用，并没有外部作用域可寻找，也不能去查找内部作用域链。")]),t._v(" "),a("p",[t._v("这样，您可以使用作用域来“保护”变量并重新使用变量。")]),t._v(" "),a("p",[t._v("除了全局和局部作用域外，还有一个块作用域。用"),a("code",[t._v("let")]),t._v("，"),a("code",[t._v("const")]),t._v("关键字声明的变量的作用域，在最接近的大括号范围内（"),a("strong",[t._v("{}")]),t._v("）。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" age "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("checkAge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" message "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"You cannot drink!"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" message\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" message "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"You can drink!"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" message\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("p",[t._v("作用域可视化为：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/23453305/118246361-7097e000-b4d4-11eb-9fd4-71865b2f7ec4.png",alt:"image"}})]),t._v(" "),a("p",[t._v("这里有一个全局作用域，一个函数作用域和两个块作用域。由于"),a("code",[t._v("message")]),t._v("变量的作用域用大括号括起来，因此我们能够对变量进行两次声明。")]),t._v(" "),a("p",[a("strong",[t._v("快速回顾：")])]),t._v(" "),a("ul",[a("li",[t._v("可以将"),a("strong",[t._v("作用域链")]),t._v("视为可以在当前上下文中访问的值的引用链。")]),t._v(" "),a("li",[t._v("作用域可以重用在作用域链外部定义的变量名称，因为它只能访问作用域链外部变量，而不能访问作用域内部变量。")])]),t._v(" "),a("p",[t._v("【完】")])])}),[],!1,null,null,null);s.default=e.exports}}]);